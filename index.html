<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoring Ibadah Keluarga Bahagia</title>
    <!-- Tailwind CSS untuk Desain Cepat -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #FDFCF0;
            -webkit-tap-highlight-color: transparent;
        }

        .custom-shadow {
            box-shadow: 0 10px 0px 0px #4A9378;
        }

        .card-shadow {
            box-shadow: 0 4px 0px 0px #E2E8F0;
        }

        .completed-shadow {
            box-shadow: 0 6px 0px 0px #FACC15;
            border-color: #FACC15 !important;
        }

        .animate-pop {
            animation: pop 0.3s ease-out;
        }

        @keyframes pop {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .lucide {
            vertical-align: middle;
        }
    </style>
</head>
<body class="pb-12 text-slate-800">

    <!-- Header -->
    <header class="bg-[#5FB494] text-white p-6 rounded-b-[3rem] mb-8 text-center border-b-4 border-[#4A9378] shadow-lg">
        <div class="flex flex-col items-center gap-2 mb-4">
            <div class="bg-white/20 p-3 rounded-full mb-2">
                <i data-lucide="moon" class="w-10 h-10"></i>
            </div>
            <h1 class="text-2xl md:text-3xl font-black uppercase tracking-tight">Monitoring Ibadah Keluarga Bahagia</h1>
            <p class="text-[10px] font-bold bg-yellow-400 text-[#4A9378] px-4 py-1 rounded-full uppercase">Ramadhan Edition âœ¨</p>
        </div>

        <!-- Date Navigator -->
        <div class="flex items-center justify-between max-w-sm mx-auto bg-white/20 p-4 rounded-3xl border border-white/30 backdrop-blur-md">
            <button onclick="changeDate(-1)" class="p-2 hover:bg-white/20 rounded-xl transition-all outline-none">
                <i data-lucide="chevron-left"></i>
            </button>
            <div class="text-center">
                <span id="display-date" class="font-black italic text-sm md:text-base text-white">Memuat Tanggal...</span>
            </div>
            <button onclick="changeDate(1)" class="p-2 hover:bg-white/20 rounded-xl transition-all outline-none">
                <i data-lucide="chevron-right"></i>
            </button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 space-y-8">
        
        <!-- Kartu Anggota Keluarga -->
        <div id="family-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Data akan diisi oleh JavaScript -->
        </div>

        <!-- Progress Bacaan Quran (BARU) -->
        <section class="bg-white p-6 rounded-[2.5rem] border-4 border-emerald-100 card-shadow">
            <div class="flex items-center gap-3 mb-4">
                <div class="bg-emerald-100 p-2 rounded-xl text-emerald-600">
                    <i data-lucide="book-open" class="w-6 h-6"></i>
                </div>
                <h2 class="text-lg font-black uppercase tracking-tight text-emerald-800">Progress Bacaan Quran</h2>
            </div>
            <div id="quran-progress-list" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Data akan diisi oleh JavaScript -->
            </div>
        </section>

        <!-- Pesan Hikmah (AI Placeholder) -->
        <div class="bg-emerald-500 text-white p-6 rounded-[2.5rem] shadow-xl border-b-8 border-emerald-700 text-center relative overflow-hidden">
            <div class="flex items-center justify-center gap-2 mb-2 text-yellow-300 font-black text-[10px] uppercase tracking-widest">
                <i data-lucide="sparkles" class="w-4 h-4"></i> Pesan Hikmah Hari Ini
            </div>
            <p id="daily-quote" class="text-lg italic font-black px-4 leading-relaxed relative z-10">
                "Barangsiapa yang berpuasa Ramadhan karena iman dan mengharap pahala, maka diampuni dosa-dosanya yang telah lalu."
            </p>
        </div>

        <!-- Capaian Akumulatif -->
        <section class="bg-[#416D5B] text-white p-8 rounded-[3rem] shadow-2xl border-b-8 border-[#2D4D40]">
            <div class="flex items-center gap-3 mb-8">
                <i data-lucide="award" class="text-yellow-400 w-8 h-8"></i>
                <h2 class="text-xl font-black uppercase tracking-tight">CAPAIAN AKUMULATIF</h2>
            </div>
            <div id="leaderboard" class="space-y-6">
                <!-- Data akan diisi oleh JavaScript -->
            </div>
        </section>

    </main>

    <!-- Modal Input Checklist -->
    <div id="modal-overlay" class="fixed inset-0 bg-emerald-900/80 backdrop-blur-md z-50 hidden flex items-end sm:items-center justify-center transition-opacity duration-300">
        <div class="bg-white w-full max-w-md rounded-t-[2.5rem] sm:rounded-[3rem] shadow-2xl overflow-hidden animate-pop border-t-8 border-emerald-500 max-h-[95vh] flex flex-col">
            <div class="bg-[#5FB494] p-5 text-white text-center relative">
                <button onclick="closeModal()" class="absolute right-5 top-5 p-1.5 bg-black/10 rounded-lg hover:bg-black/20 outline-none">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
                <div class="flex flex-col items-center">
                    <div id="modal-avatar" class="text-4xl mb-1">ðŸ‘¨</div>
                    <h3 id="modal-name" class="text-xl font-black uppercase">Nama Anggota</h3>
                    <p class="text-emerald-100 text-[10px] font-bold uppercase tracking-widest">Ceklis Ibadah Hari Ini</p>
                </div>
            </div>
            
            <div id="task-list" class="p-4 space-y-2 bg-[#FDFCF0] overflow-y-auto flex-1">
                <!-- Checklist akan diisi oleh JavaScript -->
            </div>
            
            <div class="p-4 bg-[#FDFCF0] shrink-0">
                <button onclick="closeModal()" class="w-full bg-[#5FB494] text-white py-3 rounded-xl font-black shadow-lg border-b-4 border-[#3D7A63] active:scale-95 transition-all outline-none hover:bg-[#4A9378]">
                    SIMPAN & TUTUP âœ¨
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Input Quran (BARU) -->
    <div id="quran-modal-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-xs rounded-[2rem] shadow-2xl overflow-hidden animate-pop border-b-8 border-emerald-600">
            <div class="bg-emerald-600 p-6 text-white text-center">
                <h3 class="text-lg font-black uppercase italic">Bacaan Quran Hari Ini</h3>
                <p class="text-[10px] opacity-80 uppercase tracking-widest mt-1">Sudah Sampai Mana?</p>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-400 mb-1 block">Nama Surat</label>
                    <input type="text" id="quran-surat" class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-emerald-500 outline-none font-bold text-sm" placeholder="Contoh: Al-Baqarah">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-400 mb-1 block">Ayat Ke</label>
                    <input type="number" id="quran-ayat" class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-emerald-500 outline-none font-bold text-sm" placeholder="Contoh: 155">
                </div>
                <button onclick="saveQuranProgress()" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-black shadow-lg border-b-4 border-emerald-800 active:scale-95 transition-all outline-none">
                    SIMPAN BACAAN
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data Dasar
        const familyMembers = ['Papa Ival', 'Mama Linda', 'Kaka Latifa', 'Ade Aulia'];
        const tasks = [
            { id: 'puasa', label: 'Puasa', icon: 'ðŸŒ™' },
            { id: 'solat', label: 'Solat 5 Waktu', icon: 'ðŸ•Œ' },
            { id: 'quran', label: 'Baca Quran 1 Juz', icon: 'ðŸ“–' },
            { id: 'duha', label: 'Solat Duha', icon: 'â˜€ï¸' },
            { id: 'tahajud', label: 'Solat Tahajud', icon: 'âœ¨' }
        ];

        let currentDate = new Date().toISOString().split('T')[0];
        let storageData = JSON.parse(localStorage.getItem('family_ramadhan_data')) || {};
        let activeMember = null;

        function getMemberIcon(name) {
            if (name.toLowerCase().includes('papa') || name.toLowerCase().includes('ayah')) return 'ðŸ‘¨';
            return 'ðŸ§•';
        }

        function initIcons() {
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        function changeDate(days) {
            let date = new Date(currentDate);
            date.setDate(date.getDate() + days);
            currentDate = date.toISOString().split('T')[0];
            render();
        }

        function formatDisplayDate(dateStr) {
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            return new Date(dateStr).toLocaleDateString('id-ID', options);
        }

        function getProgress(name, date) {
            const dayData = storageData[date]?.[name] || {};
            let doneCount = 0;
            tasks.forEach(task => {
                if (dayData[task.id]) doneCount++;
            });
            return (doneCount / tasks.length) * 100;
        }

        function getAverage(name) {
            const dates = Object.keys(storageData);
            if (dates.length === 0) return 0;
            let totalScore = 0;
            let dateCount = 0;
            dates.forEach(d => {
                const dayData = storageData[d]?.[name];
                if (dayData) {
                    let dailyDone = 0;
                    tasks.forEach(task => { if (dayData[task.id]) dailyDone++; });
                    totalScore += (dailyDone / tasks.length) * 100;
                    dateCount++;
                }
            });
            return dateCount === 0 ? 0 : totalScore / dateCount;
        }

        // Mendapatkan bacaan quran terakhir (lintas tanggal)
        function getLatestQuran(name) {
            // Urutkan tanggal dari yang terbaru
            const sortedDates = Object.keys(storageData).sort((a, b) => new Date(b) - new Date(a));
            for (let date of sortedDates) {
                const data = storageData[date]?.[name];
                if (data && data.quran_surat) {
                    return { surat: data.quran_surat, ayat: data.quran_ayat };
                }
            }
            return null;
        }

        function toggleTask(taskId) {
            if (!storageData[currentDate]) storageData[currentDate] = {};
            if (!storageData[currentDate][activeMember]) storageData[currentDate][activeMember] = {};
            
            const currentVal = storageData[currentDate][activeMember][taskId];
            
            // Logika Khusus untuk Quran
            if (taskId === 'quran' && !currentVal) {
                openQuranModal();
                return;
            }

            storageData[currentDate][activeMember][taskId] = !currentVal;
            localStorage.setItem('family_ramadhan_data', JSON.stringify(storageData));
            renderTasks();
        }

        function openQuranModal() {
            // Ambil data terakhir untuk default input
            const last = getLatestQuran(activeMember);
            document.getElementById('quran-surat').value = last ? last.surat : '';
            document.getElementById('quran-ayat').value = last ? last.ayat : '';
            document.getElementById('quran-modal-overlay').classList.remove('hidden');
        }

        function saveQuranProgress() {
            const surat = document.getElementById('quran-surat').value;
            const ayat = document.getElementById('quran-ayat').value;

            if (!surat || !ayat) return;

            if (!storageData[currentDate]) storageData[currentDate] = {};
            if (!storageData[currentDate][activeMember]) storageData[currentDate][activeMember] = {};

            storageData[currentDate][activeMember]['quran'] = true;
            storageData[currentDate][activeMember]['quran_surat'] = surat;
            storageData[currentDate][activeMember]['quran_ayat'] = ayat;

            localStorage.setItem('family_ramadhan_data', JSON.stringify(storageData));
            
            document.getElementById('quran-modal-overlay').classList.add('hidden');
            renderTasks();
        }

        function openModal(name) {
            activeMember = name;
            document.getElementById('modal-name').innerText = name;
            document.getElementById('modal-avatar').innerText = getMemberIcon(name);
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            renderTasks();
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
            document.body.style.overflow = 'auto';
            activeMember = null;
            render();
        }

        function renderTasks() {
            const container = document.getElementById('task-list');
            container.innerHTML = '';
            
            tasks.forEach(task => {
                const isDone = storageData[currentDate]?.[activeMember]?.[task.id];
                const item = document.createElement('div');
                const bgClass = isDone ? 'bg-emerald-50 border-emerald-500' : 'bg-white border-transparent shadow-sm hover:border-emerald-200';
                const checkClass = isDone ? 'bg-emerald-500 border-emerald-500' : 'border-slate-200 bg-slate-50';

                item.className = `flex items-center justify-between p-2.5 rounded-xl border-2 transition-all cursor-pointer ${bgClass}`;
                item.onclick = () => toggleTask(task.id);
                
                let details = '';
                if(task.id === 'quran' && isDone) {
                    const data = storageData[currentDate][activeMember];
                    details = `<div class="text-[10px] text-emerald-600 font-bold">${data.quran_surat} : ${data.quran_ayat}</div>`;
                }

                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-xl">${task.icon}</span>
                        <div>
                            <span class="font-bold text-slate-700 text-sm block">${task.label}</span>
                            ${details}
                        </div>
                    </div>
                    <div class="w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all ${checkClass}">
                        ${isDone ? '<i data-lucide="check" class="w-4 h-4 text-white"></i>' : ''}
                    </div>
                `;
                container.appendChild(item);
            });
            initIcons();
        }

        function render() {
            document.getElementById('display-date').innerText = formatDisplayDate(currentDate);

            // Render Grid Keluarga
            const grid = document.getElementById('family-grid');
            grid.innerHTML = '';
            familyMembers.forEach(name => {
                const prog = getProgress(name, currentDate);
                const isFull = prog === 100;
                const card = document.createElement('div');
                card.onclick = () => openModal(name);
                card.className = `bg-white p-6 rounded-[2.5rem] border-4 cursor-pointer transition-all hover:-translate-y-1 active:scale-95 relative overflow-hidden ${isFull ? 'completed-shadow' : 'border-emerald-100 card-shadow hover:border-emerald-200'}`;
                
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-4 relative z-10">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl bg-slate-50 p-2 rounded-full border border-slate-100">${getMemberIcon(name)}</span>
                            <h3 class="text-lg font-black text-slate-800">${name}</h3>
                        </div>
                        <div class="bg-slate-100 p-2 rounded-full">
                           <i data-lucide="chevron-right" class="text-slate-400 w-5 h-5"></i>
                        </div>
                    </div>
                    <div class="flex justify-between items-end mb-2 relative z-10">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">PROGRESS HARI INI</span>
                        <span class="text-xs font-black ${isFull ? 'text-yellow-500' : 'text-emerald-600'}">${Math.round(prog)}%</span>
                    </div>
                    <div class="w-full bg-slate-100 h-4 rounded-full overflow-hidden p-1 relative z-10">
                        <div class="h-full rounded-full transition-all duration-700 ${isFull ? 'bg-yellow-400' : 'bg-emerald-500'}" style="width: ${prog}%"></div>
                    </div>
                    ${isFull ? '<div class="absolute -right-4 -bottom-4 text-yellow-100/50 rotate-12"><i data-lucide="trophy" class="w-32 h-32"></i></div>' : ''}
                `;
                grid.appendChild(card);
            });

            // Render Progress Quran (BARU)
            const quranList = document.getElementById('quran-progress-list');
            quranList.innerHTML = '';
            familyMembers.forEach(name => {
                const last = getLatestQuran(name);
                const item = document.createElement('div');
                item.className = 'bg-slate-50 p-4 rounded-2xl flex items-center gap-3 border border-slate-100';
                item.innerHTML = `
                    <div class="text-2xl">${getMemberIcon(name)}</div>
                    <div>
                        <div class="text-[10px] font-black uppercase text-slate-400">${name}</div>
                        <div class="text-sm font-bold text-slate-700">
                            ${last ? `<span class="text-emerald-600">${last.surat}</span> <span class="text-slate-400">Ayat</span> ${last.ayat}` : '<span class="text-slate-300 italic">Belum ada bacaan</span>'}
                        </div>
                    </div>
                `;
                quranList.appendChild(item);
            });

            // Render Leaderboard
            const leaderboard = document.getElementById('leaderboard');
            leaderboard.innerHTML = '';
            const sortedMembers = [...familyMembers].sort((a, b) => getAverage(b) - getAverage(a));
            sortedMembers.forEach((name, index) => {
                const avg = getAverage(name);
                const item = document.createElement('div');
                item.className = 'space-y-2';
                let medal = '';
                if(index === 0 && avg > 0) medal = 'ðŸ¥‡';
                if(index === 1 && avg > 0) medal = 'ðŸ¥ˆ';
                if(index === 2 && avg > 0) medal = 'ðŸ¥‰';
                item.innerHTML = `
                    <div class="flex justify-between text-xs font-black uppercase tracking-wider items-center">
                        <div class="flex gap-2"><span>${medal}</span><span>${name}</span></div>
                        <span class="text-yellow-400 bg-black/20 px-2 py-0.5 rounded-lg">${avg.toFixed(0)}%</span>
                    </div>
                    <div class="w-full bg-black/20 h-3 rounded-full overflow-hidden p-0.5 border border-white/10">
                        <div class="h-full bg-yellow-400 rounded-full transition-all duration-1000" style="width: ${avg}%"></div>
                    </div>
                `;
                leaderboard.appendChild(item);
            });

            initIcons();
        }

        window.onload = function() {
            render();
            setTimeout(initIcons, 500); 
        };
    </script>
</body>
</html>
